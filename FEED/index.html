<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FEED Swap</title>
    <link rel="icon" type="image/png" href="https://woofswap.finance/image/tokens/feed.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FF8C00;
            --secondary-color: #FFA500;
            --card-bg: #1E1E1E;
            --input-bg: #252525;
            --text-color: #E0E0E0;
            --border-radius: 16px;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: #121212;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        .header h1 {
            font-size: clamp(2rem, 5vw, 2.5rem);
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: 1px;
        }
        .connect-section {
            margin-bottom: 16px;
        }
        .connect-section button {
            padding: 10px 24px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #FFF;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s, background 0.3s;
        }
        .connect-section button:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
        }
        .connect-section .status {
            font-size: 0.9rem;
            color: var(--primary-color);
            text-align: center;
            margin-top: 8px;
        }
        .token-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            justify-content: center;
        }
        .token-card {
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
        }
        .token-header {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--input-bg);
            border-bottom: 1px solid #333;
        }
        .token-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            flex-grow: 1;
        }
        .token-header .copy-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            position: relative;
        }
        .token-header .copy-button img {
            width: 18px;
            height: 18px;
            filter: invert(1);
        }
        .token-header .copy-button .tooltip {
            visibility: hidden;
            background: var(--primary-color);
            color: #FFF;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
            position: absolute;
            top: -30px;
            right: 0;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .token-header .copy-button.copied .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .token-image {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            border-bottom: 1px solid #333;
        }
        .token-content {
            padding: 16px;
            flex-grow: 1;
        }
        .token-content h4 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary-color);
        }
        .token-content p.description {
            font-size: 0.9rem;
            color: #B0B0B0;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        .token-content .info {
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .token-content .info img {
            width: 16px;
            height: 16px;
            filter: invert(1);
        }
        .token-content .info a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .token-content .info a:hover {
            color: var(--secondary-color);
        }
        .trade-section {
            padding: 16px;
            border-top: 1px solid #333;
        }
        .swap-box {
            background: var(--input-bg);
            padding: 16px;
            border-radius: 12px;
        }
        .swap-toggle {
            display: flex;
            margin-bottom: 12px;
        }
        .swap-toggle button {
            flex: 1;
            padding: 8px;
            border: none;
            background: #333;
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .swap-toggle button.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #FFF;
        }
        .swap-toggle button:first-child {
            border-radius: 12px 0 0 12px;
        }
        .swap-toggle button:last-child {
            border-radius: 0 12px 12px 0;
        }
        .balance-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        .token-info {
            display: flex;
            align-items: center;
            padding: 8px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .token-info img {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        .token-info span {
            font-size: 0.9rem;
        }
        .swap-box input {
            width: 100%;
            padding: 10px;
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 8px;
            color: var(--text-color);
            font-size: 0.9rem;
            text-align: right;
            outline: none;
        }
        .percentage-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 8px 0;
        }
        .percentage-buttons button {
            background: #333;
            border: 1px solid #444;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-color);
            font-size: 0.85rem;
            font-weight: 600;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .percentage-buttons button:hover {
            background: var(--primary-color);
            color: #FFF;
            transform: scale(1.05);
        }
        .percentage-buttons button.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #FFF;
            border-color: var(--primary-color);
        }
        .swap-box .trade-button {
            padding: 10px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: #FFF;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            font-size: 0.9rem;
            position: relative;
            transition: background 0.3s;
        }
        .swap-box .trade-button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .swap-box .trade-button:hover:not(:disabled) {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
        }
        .swap-box .trade-button .spinner {
            display: none;
            border: 2px solid #FFF;
            border-top: 2px solid transparent;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
        }
        .swap-box .trade-button.loading .spinner {
            display: block;
        }
        .swap-info {
            font-size: 0.85rem;
            color: var(--primary-color);
            margin-top: 8px;
        }
        .dog-message {
            font-size: 0.85rem;
            color: var(--secondary-color);
            text-align: center;
            margin-top: 12px;
            font-style: italic;
        }
        #dexscreener-embed {
            position: relative;
            width: 100%;
            max-width: 500px;
            padding-bottom: 125%;
        }
        @media (min-width: 768px) {
            .token-container {
                flex-wrap: nowrap;
            }
            .token-card, #dexscreener-embed {
                flex: 1;
                min-width: 0;
            }
        }
        @media (min-width: 1400px) {
            #dexscreener-embed {
                padding-bottom: 65%;
            }
        }
        #dexscreener-embed iframe {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            border: 0;
        }
        .footer {
            font-size: 0.8rem;
            color: #B0B0B0;
            text-align: center;
            margin-top: auto;
            padding: 16px;
        }
        .footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .footer a:hover {
            color: var(--secondary-color);
        }
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .token-card {
                max-width: 100%;
            }
            .token-header h3 {
                font-size: 1rem;
            }
            .token-content h4 {
                font-size: 1.2rem;
            }
            .token-content p.description {
                font-size: 0.85rem;
            }
            .percentage-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            .connect-section button {
                font-size: 0.9rem;
                padding: 8px 20px;
            }
            .swap-box input, .trade-button {
                font-size: 0.85rem;
            }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>FEED Swap</h1>
    </div>
    <div class="connect-section">
        <button id="connectWalletButton">Connect wallet</button>
        <div id="networkStatus" class="status">Click to connect...</div>
    </div>
    <div class="dog-message" id="dogMessage">Woof! Connect your wallet to start swapping, pup!</div>
    <div class="token-container">
        <div class="token-card" id="tokenCard"></div>
        <div id="dexscreener-embed">
            <iframe src="https://dexscreener.com/shibarium/0xD4301bA08076C14Dfc93fd0a94151E338874D7FE?embed=1&loadChartSettings=0&tabs=0&info=0&chartLeftToolbar=0&chartDefaultOnMobile=1&chartTheme=dark&theme=dark&chartStyle=1&chartType=price&interval=1D" loading="lazy"></iframe>
        </div>
    </div>
    <div class="footer">
        Powered by <a href="https://shibarium.shib.io/" target="_blank">Shibarium</a> | ShibClub © 2025
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        const boneToken = {
            address: "0x839FdB6cc98342B428E074C1573ADF6D48CA3bFd",
            symbol: "BONE",
            logo: "https://www.woofswap.finance/image/tokens/BONE.png",
            isNative: true
        };
        const feedToken = {
            address: "0xD4301bA08076C14Dfc93fd0a94151E338874D7FE",
            symbol: "FEED",
            logo: "https://woofswap.finance/image/tokens/feed.png"
        };
        const routerAddress = "0x96b16aBD53Bfd765F4CD118590C1d0be8B57DE24";
        const factoryAddress = "0xB9fbdFA27B7ba8BB2d4bB4aB399e4c55F0F7F83a";
        const wboneAddress = "0x839FdB6cc98342B428E074C1573ADF6D48CA3bFd";
        const routerAbi = [
            {"inputs":[{"internalType":"uint256","name":"amountOutMin","type":"uint256"},{"components":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"bool","name":"stable","type":"bool"}],"internalType":"struct Router.route[]","name":"routes","type":"tuple[]"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"deadline","type":"uint256"}],"name":"swapExactETHForTokensSupportingFeeOnTransferTokens","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amountIn","type":"uint256"},{"internalType":"uint256","name":"amountOutMin","type":"uint256"},{"components":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"bool","name":"stable","type":"bool"}],"internalType":"struct Router.route[]","name":"routes","type":"tuple[]"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"deadline","type":"uint256"}],"name":"swapExactTokensForETHSupportingFeeOnTransferTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amountIn","type":"uint256"},{"components":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"bool","name":"stable","type":"bool"}],"internalType":"struct Router.route[]","name":"routes","type":"tuple[]"}],"name":"getAmountsOut","outputs":[{"internalType":"uint256[]","name":"amounts","type":"uint256[]"}],"stateMutability":"view","type":"function"}
        ];
        const factoryAbi = [
            {"inputs":[{"internalType":"address","name":"tokenA","type":"address"},{"internalType":"address","name":"tokenB","type":"address"},{"internalType":"bool","name":"stable","type":"bool"}],"name":"getPair","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}
        ];
        const pairAbi = [
            {"inputs":[],"name":"getReserves","outputs":[{"internalType":"uint256","name":"reserve0","type":"uint256"},{"internalType":"uint256","name":"reserve1","type":"uint256"},{"internalType":"uint32","name":"blockTimestampLast","type":"uint32"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"token0","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"token1","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}
        ];
        const erc20Abi = [
            {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"uint256"}],"type":"function"},
            {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"type":"function"},
            {"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"type":"function"}
        ];
        const shibarium = {
            chainId": 109,
            chainName: "Shibarium",
            nativeCurrency: { name: "BONE", symbol: "BONE", decimals: 18 },
            rpcUrls: ["https://rpc.shibrpc.com"],
            blockExplorerUrls: ["https://shibariumscan.io"]
        };
        let web3, account, router, factory;
        let fromToken = boneToken;
        let toToken = feedToken;
        let fromBalance = "0";
        let isFromBone = true;
        let isApproving = false;
        const defaultSlippage = 0.005;
        const maxPriceImpact = 50;

        const dogMessages = {
                        connectStart: ["Woof woof! Sniffing out your wallet, hold tight, human!", "Arf! Digging into Shibarium, let’s fetch that wallet!", "Bow wow! Connecting to your stash, stay pawsitive!", "Woof! I smell a wallet, let’s link it up quick!"],
            connectSuccess: ["Arf arf! You’re in, pup! Time to chase some BONEs!", "Woof! Wallet’s hooked, ready to roll in Shibarium!", "Yip yip! Connected, hooman! Let’s swap some treats!", "Bow wow! Welcome aboard, let’s sniff out some swaps!"],
            connectFail: ["Grrr... Wallet slipped away, try again, hooman!", "Woof? No wallet scent detected, give it another go!", "Arf! Something barked up, retry connecting, pup!", "Ruff! Wallet’s hiding, let’s dig it out again!"],
            switchTokens: ["Woof woof! Flipping tokens like a Shib pro, huh?", "Arf! Swapping sides, let’s keep the tail wagging!", "Bow wow! Token switcheroo, you’re a clever pup!", "Ruff ruff! Mixing it up, let’s see what we fetch!"],
            setPercentage: (percent) => [`Woof! ${percent}% in? You’re a bold Shib, hooman!`, `Arf arf! Going ${percent}%? Let’s dig into that swap!`, `Bow wow! ${percent}% of the stash? Pawsitively daring!`, `Yip! ${percent}%? You’re chasing big bones today!`],
            calcStart: ["Woof! Sniffing out the best price, hang tight!", "Arf! Digging up some swap numbers, stay put, pup!", "Bow wow! Crunching bones, I’ll fetch the output soon!", "Ruff! Calculating your treat, give me a sec, hooman!"],
            calcSuccess: (amount, symbol) => [`Arf! Found ya ${amount} ${symbol}! Ready to swap, pup?`, `Woof woof! Snagged ${amount} ${symbol}, let’s roll!`, `Yip yip! Dug up ${amount} ${symbol}, happy tail wags!`, `Bow wow! ${amount} ${symbol} sniffed out, swap time!`],
            calcFail: ["Grrr... No path for these bones, try a new pair, pup!", "Woof? Swap trail’s cold, pick another token, hooman!", "Arf arf! Couldn’t fetch the output, let’s retry!", "Ruff! Swap math barked up, give it another go!"],
            swapStart: ["Woof woof! Swapping time, let’s fetch those tokens!", "Arf! Launching the swap, hold onto your leash, pup!", "Bow wow! Trading bones, here we go, Shib style!", "Yip! Swapping in Shibarium, let’s make it pawsome!"],
            swapSuccess: ["Arf arf! Swap done, you’re a Woofswap champ, hooman!", "Woof! Tokens fetched, tail-wagging success, pup!", "Bow wow! Swapped like a pro, time to celebrate!", "Yip yip! Swap complete, you’re the top dog now!"],
            swapFail: ["Grrr... Swap didn’t work, let’s try again, pup!", "Woof? Swap got lost, retry it, clever hooman!", "Arf! Token chase failed, another go, Shib friend?", "Ruff ruff! Swap slipped, let’s dig it up again!"],
            swapNoAmount: ["Arf! No amount? How am I supposed to swap air?!", "Woof woof! Gimme a number, pup, or we’re stuck!", "Bow wow! Empty swap? Fill it up, hooman!", "Ruff! Amount’s missing, let’s fetch some digits!"],
            highPriceImpact: ["Woof woof! That swap has a huge price impact, pup! Try a smaller amount!", "Arf! Too many bones at once—price impact’s too high, hooman!", "Bow wow! Swap’s too big for the pool, let’s scale it down!", "Ruff! Price impact’s barking mad—reduce the amount, Shib friend!"],
            insufficientLiquidity: ["Grrr... Not enough bones in the pool for this swap, pup!", "Woof? Pool’s too shallow—try a smaller swap, hooman!", "Arf arf! Liquidity’s low, can’t fetch that many bones!", "Ruff! Pool’s running dry—let’s try a smaller trade!"],
            approving: ["Woof! Approving your tokens, hold on, pup!", "Arf! Sniffing out approval, almost there, hooman!", "Bow wow! Authorizing the swap, stay pawsitive!", "Ruff! Getting ready to trade, approving now!"],
            userDenied: ["Woof woof! You scared me off, hooman! Approve next time, pup!", "Arf! No swap today? You’re a tricky one, let’s try again!", "Bow wow! Rejected my trade? Give me a bone next time!", "Ruff ruff! You denied me, hooman! Let’s wag back later!"]
        };

        function getRandomMessage(type, param1, param2) {
            const messages = dogMessages[type];
            if (typeof messages === 'function') {
                const options = messages(param1, param2);
                return options[Math.floor(Math.random() * options.length)];
            }
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function shortenAddress(address) {
            return address ? `${address.slice(0, 6)}...${address.slice(-4)}` : "0x...";
        }

        async function connectWallet() {
            const status = document.getElementById("networkStatus");
            const connectButton = document.getElementById("connectWalletButton");
            const dogMessage = document.getElementById("dogMessage");
            try {
                if (!window.ethereum) throw new Error("No wallet detected. Please install MetaMask.");
                connectButton.disabled = true;
                status.innerText = "Connecting...";
                dogMessage.innerText = getRandomMessage("connectStart");
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
                if (!accounts.length) throw new Error("No accounts found. Please unlock your wallet.");
                account = accounts[0];
                const chainId = await web3.eth.getChainId();
                if (Number(chainId) !== 109) {
                    try {
                        await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: "0x6d" }] });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({ method: "wallet_addEthereumChain", params: [shibarium] });
                        } else {
                            throw switchError;
                        }
                    }
                }
                router = new web3.eth.Contract(routerAbi, routerAddress);
                factory = new web3.eth.Contract(factoryAbi, factoryAddress);
                connectButton.innerText = `Connected: ${shortenAddress(account)}`;
                status.innerText = "Connected to Shibarium";
                dogMessage.innerText = getRandomMessage("connectSuccess");
                await updateBalances();
                updateTradeButtonState();
                await loadToken();
            } catch (error) {
                status.innerText = `Failed: ${error.message}`;
                dogMessage.innerText = getRandomMessage("connectFail");
                resetUI();
            } finally {
                connectButton.disabled = false;
            }
        }

        function resetUI() {
            document.getElementById("connectWalletButton").innerText = "Connect wallet";
            document.getElementById("networkStatus").innerText = "Click to connect...";
            document.getElementById("dogMessage").innerText = "Woof! Connect your wallet to start swapping, pup!";
            const tradeButton = document.querySelector(".trade-button");
            if (tradeButton) tradeButton.disabled = true;
        }

        function setupWalletListeners() {
            if (!window.ethereum) return;
            window.ethereum.on("accountsChanged", async (newAccounts) => {
                if (newAccounts.length) {
                    account = newAccounts[0];
                    if (web3) {
                        const chainId = await web3.eth.getChainId();
                        if (Number(chainId) !== 109) {
                            await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: "0x6d" }] });
                        }
                        router = new web3.eth.Contract(routerAbi, routerAddress);
                        factory = new web3.eth.Contract(factoryAbi, factoryAddress);
                        document.getElementById("connectWalletButton").innerText = `Connected: ${shortenAddress(account)}`;
                        document.getElementById("networkStatus").innerText = "Connected to Shibarium";
                        document.getElementById("dogMessage").innerText = getRandomMessage("connectSuccess");
                        await updateBalances();
                        updateTradeButtonState();
                    } else {
                        await connectWallet();
                    }
                } else {
                    web3 = null;
                    account = null;
                    router = null;
                    factory = null;
                    resetUI();
                }
            });
            window.ethereum.on("chainChanged", async (chainId) => {
                if (parseInt(chainId, 16) !== 109) {
                    web3 = null;
                    account = null;
                    router = null;
                    factory = null;
                    resetUI();
                    document.getElementById("networkStatus").innerText = "Wrong network. Reconnect to Shibarium.";
                    document.getElementById("dogMessage").innerText = "Woof! Wrong chain, pup! Switch to Shibarium!";
                } else if (account) {
                    await connectWallet();
                }
            });
        }

        async function updateBalances() {
            if (!web3 || !account) return;
            const card = document.getElementById("tokenCard");
            if (isFromBone) {
                fromBalance = await web3.eth.getBalance(account);
                card.querySelector(".balance-row").innerHTML = `<span>BONE</span><span>Balance: ${parseFloat(web3.utils.fromWei(fromBalance, "ether")).toFixed(2)}</span>`;
            } else {
                const tokenContract = new web3.eth.Contract(erc20Abi, feedToken.address);
                fromBalance = await tokenContract.methods.balanceOf(account).call();
                card.dataset.tokenBalance = fromBalance;
                card.querySelector(".balance-row").innerHTML = `<span>FEED</span><span>Balance: ${parseFloat(web3.utils.fromWei(fromBalance, "ether")).toFixed(2)}</span>`;
            }
            const toBalance = isFromBone
                ? await new web3.eth.Contract(erc20Abi, feedToken.address).methods.balanceOf(account).call()
                : await web3.eth.getBalance(account);
            card.dataset.toBalance = toBalance;
        }

        async function calculateOutput() {
            const card = document.getElementById("tokenCard");
            const amountIn = card.querySelector(".amount-input").value;
            const swapInfo = card.querySelector(".swap-info");
            const dogMessage = document.getElementById("dogMessage");
            if (!web3 || !account || !amountIn || amountIn <= 0) {
                swapInfo.innerText = "Enter a valid amount";
                return;
            }
            let amountInWei;
            try {
                amountInWei = web3.utils.toBN(web3.utils.toWei(amountIn, "ether"));
            } catch (error) {
                swapInfo.innerText = "Invalid amount entered";
                dogMessage.innerText = getRandomMessage("swapNoAmount");
                return;
            }
            swapInfo.innerHTML = `Calculating... <span class="spinner"></span>`;
            dogMessage.innerText = getRandomMessage("calcStart");
            try {
                let bestOutput = web3.utils.toBN("0");
                let routes;
                for (const stable of [true, false]) {
                    const pairAddress = await factory.methods.getPair(fromToken.address, toToken.address, stable).call();
                    if (pairAddress !== "0x0000000000000000000000000000000000000000") {
                        const tempRoutes = [{ from: fromToken.address, to: toToken.address, stable }];
                        const amounts = await router.methods.getAmountsOut(amountInWei, tempRoutes).call();
                        const output = web3.utils.toBN(amounts[amounts.length - 1]);
                        if (output.gt(bestOutput)) {
                            bestOutput = output;
                            routes = tempRoutes;
                        }
                    }
                }
                if (bestOutput.eq(web3.utils.toBN("0"))) {
                    swapInfo.innerText = "No valid trading pair found";
                    dogMessage.innerText = getRandomMessage("calcFail");
                    return;
                }
                const outputEther = parseFloat(web3.utils.fromWei(bestOutput, "ether")).toFixed(6);
                swapInfo.innerText = `Estimated output: ${outputEther} ${isFromBone ? "FEED" : "BONE"}`;
                dogMessage.innerText = getRandomMessage("calcSuccess", outputEther, isFromBone ? "FEED" : "BONE");
                card.dataset.routes = JSON.stringify(routes);
                card.dataset.bestOutput = bestOutput.toString();
            } catch (error) {
                swapInfo.innerText = "Error calculating output";
                dogMessage.innerText = getRandomMessage("calcFail");
            }
        }

        function updateTradeButtonState() {
            const card = document.getElementById("tokenCard");
            const tradeButton = card.querySelector(".trade-button");
            const amountInput = card.querySelector(".amount-input");
            const amount = parseFloat(amountInput.value);
            tradeButton.disabled = !account || !amount || amount <= 0;
        }

        async function loadToken() {
            const card = document.getElementById("tokenCard");
            const dogMessage = document.getElementById("dogMessage");
            try {
                dogMessage.innerText = "Woof! Loading FEED, pup!";
                let tokenBalance = "0";
                let boneBalance = "0";
                if (account) {
                    const tokenContract = new web3.eth.Contract(erc20Abi, feedToken.address);
                    tokenBalance = await tokenContract.methods.balanceOf(account).call();
                    boneBalance = await web3.eth.getBalance(account);
                }
                card.dataset.tokenBalance = tokenBalance;
                card.dataset.toBalance = boneBalance;
                const boneBalanceDisplay = parseFloat(web3.utils.fromWei(boneBalance, "ether")).toFixed(2);
                card.innerHTML = `
                    <div class="token-header">
                        <h3>Created by: FEED</h3>
                        <button class="copy-button" data-address="${feedToken.address}">
                            <img src="https://img.icons8.com/ios-filled/16/000000/contract.png" alt="Copy Contract">
                            <span class="tooltip">Copied Contract!</span>
                        </button>
                    </div>
                    <img class="token-image" src="${feedToken.logo}" alt="FEED">
                    <div class="token-content">
                        <h4>FEED</h4>
                        <p class="description">FEED enhances Shibarium’s ecosystem by incentivizing participation and supporting SHIB’s deflationary mechanics through its unique burning process.</p>
                        <div class="info">
                            <img src="https://img.icons8.com/ios-filled/16/000000/link.png" alt="Website">
                            <a href="https://feed.shib.io/" target="_blank">shib.club</a>
                        </div>
                        <div class="info">
                            <img src="https://img.icons8.com/ios-filled/16/000000/twitter.png" alt="Twitter">
                            <a href="https://x.com/feedevery" target="_blank">@feedevery</a>
                        </div>
                        <div class="info">
                            <img src="https://img.icons8.com/ios-filled/16/000000/telegram-app.png" alt="Telegram">
                            <a href="https://t.me/FEED" target="_blank">FEED</a>
                        </div>
                    </div>
                    <div class="trade-section">
                        <div class="swap-box">
                            <div class="swap-toggle">
                                <button class="buy active">Buy</button>
                                <button class="sell">Sell</button>
                            </div>
                            <div class="balance-row">
                                <span>BONE</span>
                                <span>Balance: ${boneBalanceDisplay}</span>
                            </div>
                            <div class="token-info">
                                <img src="${boneToken.logo}" alt="BONE">
                                <span>BONE</span>
                            </div>
                            <input type="number" class="amount-input" placeholder="0.0" step="0.01">
                            <div class="percentage-buttons">
                                <button data-percentage="25">25%</button>
                                <button data-percentage="50">50%</button>
                                <button data-percentage="75">75%</button>
                                <button data-percentage="100">MAX</button>
                            </div>
                            <div class="swap-info">Enter a valid amount</div>
                            <button class="trade-button" disabled>
                                Buy
                                <span class="spinner"></span>
                            </button>
                        </div>
                    </div>
                `;
                setupCardListeners(card);
                dogMessage.innerText = "Woof! FEED loaded, ready to swap, pup!";
            } catch (error) {
                dogMessage.innerText = `Woof? Failed to load FEED: ${error.message}`;
            }
        }

        function setupCardListeners(card) {
            card.querySelectorAll(".copy-button").forEach(button => {
                button.addEventListener("click", () => {
                    navigator.clipboard.writeText(button.dataset.address).then(() => {
                        button.classList.add("copied");
                        setTimeout(() => button.classList.remove("copied"), 1000);
                    }).catch(() => {
                        document.getElementById("dogMessage").innerText = "Woof! Failed to copy address, pup!";
                    });
                });
            });
            card.querySelectorAll(".swap-toggle button").forEach(button => {
                button.addEventListener("click", async () => {
                    card.querySelectorAll(".swap-toggle button").forEach(btn => btn.classList.remove("active"));
                    button.classList.add("active");
                    isFromBone = button.classList.contains("buy");
                    fromToken = isFromBone ? boneToken : feedToken;
                    toToken = isFromBone ? feedToken : boneToken;
                    const balanceRow = card.querySelector(".balance-row");
                    const tokenInfo = card.querySelector(".token-info");
                    const tradeButton = card.querySelector(".trade-button");
                    const input = card.querySelector(".amount-input");
                    const dogMessage = document.getElementById("dogMessage");
                    if (isFromBone) {
                        balanceRow.innerHTML = `<span>BONE</span><span>Balance: ${parseFloat(web3.utils.fromWei(fromBalance, "ether")).toFixed(2)}</span>`;
                        tokenInfo.innerHTML = `<img src="${boneToken.logo}" alt="BONE"><span>BONE</span>`;
                        tradeButton.innerHTML = "Buy <span class='spinner'></span>";
                    } else {
                        balanceRow.innerHTML = `<span>FEED</span><span>Balance: ${parseFloat(web3.utils.fromWei(card.dataset.tokenBalance, "ether")).toFixed(2)}</span>`;
                        tokenInfo.innerHTML = `<img src="${feedToken.logo}" alt="FEED"><span>FEED</span>`;
                        tradeButton.innerHTML = "Sell <span class='spinner'></span>";
                    }
                    input.value = "";
                    card.querySelector(".swap-info").innerText = "Enter a valid amount";
                    dogMessage.innerText = getRandomMessage("switchTokens");
                    await updateBalances();
                    updateTradeButtonState();
                });
            });
            card.querySelector(".trade-button").addEventListener("click", async () => {
                await swapTokens();
            });
            card.querySelector(".amount-input").addEventListener("input", () => {
                updateTradeButtonState();
                calculateOutput();
            });
            card.querySelectorAll(".percentage-buttons button").forEach(button => {
                button.addEventListener("click", () => {
                    card.querySelectorAll(".percentage-buttons button").forEach(btn => btn.classList.remove("active"));
                    button.classList.add("active");
                    setPercentage(button.dataset.percentage);
                });
            });
        }

        async function setPercentage(percentage) {
            const card = document.getElementById("tokenCard");
            const dogMessage = document.getElementById("dogMessage");
            if (!web3 || !account) {
                document.getElementById("networkStatus").innerText = "Please connect wallet first.";
                dogMessage.innerText = getRandomMessage("connectFail");
                return;
            }
            const input = card.querySelector(".amount-input");
            let amount;
            if (isFromBone) {
                let balance = parseFloat(web3.utils.fromWei(fromBalance, "ether"));
                amount = percentage === "100" ? Math.max(0, balance - 0.01) : balance * (percentage / 100);
            } else {
                let balance = parseFloat(web3.utils.fromWei(card.dataset.tokenBalance, "ether"));
                amount = percentage === "100" ? balance : balance * (percentage / 100);
            }
            input.value = amount.toFixed(4);
            dogMessage.innerText = getRandomMessage("setPercentage", percentage);
            updateTradeButtonState();
            calculateOutput();
        }

        async function approveToken(tokenAddress, amount) {
            if (tokenAddress === wboneAddress && fromToken.isNative) return;
            const tokenContract = new web3.eth.Contract(erc20Abi, tokenAddress);
            const allowance = await tokenContract.methods.allowance(account, routerAddress).call();
            if (web3.utils.toBN(allowance).lt(web3.utils.toBN(amount))) {
                const card = document.getElementById("tokenCard");
                const tradeButton = card.querySelector(".trade-button");
                const dogMessage = document.getElementById("dogMessage");
                isApproving = true;
                tradeButton.textContent = "Authorizing...";
                tradeButton.disabled = true;
                dogMessage.innerText = getRandomMessage("approving");
                await tokenContract.methods.approve(routerAddress, amount).send({ from: account });
                document.getElementById("networkStatus").innerText = "Token approved";
                isApproving = false;
                tradeButton.textContent = isFromBone ? "Buy" : "Sell";
                tradeButton.disabled = false;
                dogMessage.innerText = "Woof! Tokens approved, ready to swap!";
            }
        }

        async function swapTokens() {
            const card = document.getElementById("tokenCard");
            const dogMessage = document.getElementById("dogMessage");
            const status = document.getElementById("networkStatus");
            const tradeButton = card.querySelector(".trade-button");
            if (isApproving) return;
            if (!web3 || !account) {
                status.innerText = "Please connect wallet.";
                dogMessage.innerText = getRandomMessage("connectFail");
                return;
            }
            const amountIn = card.querySelector(".amount-input").value;
            if (!amountIn || amountIn <= 0) {
                status.innerText = "Please enter a valid amount.";
                dogMessage.innerText = getRandomMessage("swapNoAmount");
                return;
            }
            let amountInWei;
            try {
                amountInWei = web3.utils.toBN(web3.utils.toWei(amountIn, "ether"));
            } catch (error) {
                status.innerText = "Invalid amount entered.";
                dogMessage.innerText = getRandomMessage("swapNoAmount");
                return;
            }
            const balanceToCheck = isFromBone ? fromBalance : card.dataset.tokenBalance;
            if (web3.utils.toBN(balanceToCheck).lt(amountInWei)) {
                status.innerText = `Insufficient ${isFromBone ? "BONE" : "FEED"} balance`;
                dogMessage.innerText = `Woof! Not enough ${isFromBone ? "BONE" : "FEED"} to swap, pup!`;
                return;
            }
            const deadline = Math.floor(Date.now() / 1000) + 60 * 20;
            try {
                tradeButton.classList.add("loading");
                tradeButton.disabled = true;
                status.innerText = "Processing swap...";
                dogMessage.innerText = getRandomMessage("swapStart");
                let bestOutput = web3.utils.toBN("0");
                let routes;
                for (const stable of [true, false]) {
                    const pairAddress = await factory.methods.getPair(fromToken.address, toToken.address, stable).call();
                    if (pairAddress !== "0x0000000000000000000000000000000000000000") {
                        const tempRoutes = [{ from: fromToken.address, to: toToken.address, stable }];
                        const amounts = await router.methods.getAmountsOut(amountInWei, tempRoutes).call();
                        const output = web3.utils.toBN(amounts[amounts.length - 1]);
                        if (output.gt(bestOutput)) {
                            bestOutput = output;
                            routes = tempRoutes;
                        }
                    }
                }
                if (!routes || bestOutput.eq(web3.utils.toBN("0"))) {
                    status.innerText = "No valid trading pair found.";
                    dogMessage.innerText = getRandomMessage("calcFail");
                    tradeButton.classList.remove("loading");
                    tradeButton.disabled = false;
                    return;
                }
                const pairAddress = await factory.methods.getPair(fromToken.address, toToken.address, routes[0].stable).call();
                const pairContract = new web3.eth.Contract(pairAbi, pairAddress);
                const reserves = await pairContract.methods.getReserves().call();
                const token0 = await pairContract.methods.token0().call();
                const reserveFrom = token0 === fromToken.address ? reserves.reserve0 : reserves.reserve1;
                const reserveTo = token0 === fromToken.address ? reserves.reserve1 : reserves.reserve0;
                const reserveFromBN = web3.utils.toBN(reserveFrom);
                const reserveToBN = web3.utils.toBN(reserveTo);
                const priceImpact = amountInWei.mul(web3.utils.toBN(100)).div(reserveFromBN.add(amountInWei));
                if (priceImpact.gt(web3.utils.toBN(maxPriceImpact))) {
                    status.innerText = `Price impact too high (${priceImpact.toString()}%)`;
                    dogMessage.innerText = getRandomMessage("highPriceImpact");
                    tradeButton.classList.remove("loading");
                    tradeButton.disabled = false;
                    return;
                }
                if (bestOutput.gt(reserveToBN)) {
                    status.innerText = "Insufficient liquidity";
                    dogMessage.innerText = getRandomMessage("insufficientLiquidity");
                    tradeButton.classList.remove("loading");
                    tradeButton.disabled = false;
                    return;
                }
                const slippageFactor = web3.utils.toBN(1000 - defaultSlippage * 1000);
                const amountOutMin = bestOutput.mul(slippageFactor).div(web3.utils.toBN(1000));
                if (!fromToken.isNative) {
                    await approveToken(fromToken.address, amountInWei);
                }
                if (isFromBone) {
                    await router.methods.swapExactETHForTokensSupportingFeeOnTransferTokens(
                        amountOutMin.toString(),
                        routes,
                        account,
                        deadline
                    ).send({ from: account, value: amountInWei });
                } else {
                    await router.methods.swapExactTokensForETHSupportingFeeOnTransferTokens(
                        amountInWei.toString(),
                        amountOutMin.toString(),
                        routes,
                        account,
                        deadline
                    ).send({ from: account });
                }
                status.innerText = "Swap successful!";
                dogMessage.innerText = getRandomMessage("swapSuccess");
                card.querySelector(".amount-input").value = "";
                card.querySelector(".swap-info").innerText = "Enter a valid amount";
                await updateBalances();
                updateTradeButtonState();
            } catch (error) {
                let errorMessage = error.message || "Transaction failed";
                if (error.code === 4001) {
                    errorMessage = "User rejected transaction";
                    dogMessage.innerText = getRandomMessage("userDenied");
                } else if (error.message.includes("INSUFFICIENT_OUTPUT_AMOUNT") || error.message.includes("EXCESSIVE_INPUT_AMOUNT")) {
                    errorMessage = "Swap failed: Price impact or slippage too high";
                    dogMessage.innerText = "Woof! Swap failed—too much price impact";
                } else if (error.message.includes("INSUFFICIENT_LIQUIDITY")) {
                    errorMessage = "Swap failed: Insufficient liquidity";
                    dogMessage.innerText = getRandomMessage("insufficientLiquidity");
                } else {
                    dogMessage.innerText = getRandomMessage("swapFail");
                }
                status.innerText = errorMessage;
            } finally {
                tradeButton.classList.remove("loading");
                tradeButton.disabled = false;
            }
        }

        document.getElementById("connectWalletButton").addEventListener("click", connectWallet);
        window.addEventListener("load", async () => {
            if (!window.location.protocol.includes("http")) {
                document.getElementById("networkStatus").innerText = 'Please run via server (e.g., "npx serve")';
                return;
            }
            resetUI();
            setupWalletListeners();
            await loadToken();
        });
    </script>
</body>
</html>
